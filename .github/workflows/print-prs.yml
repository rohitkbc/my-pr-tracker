name: Print My GitHub Activity

on:
  workflow_dispatch:

jobs:
  print-activity:
    runs-on: ubuntu-latest

    steps:
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install requests

      - name: Print PRs, Issues, Reviews to logs
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_USERNAME: rohitkbc
        run: |
          python << 'EOF'
          import os
          import requests

          TOKEN = os.environ["GITHUB_TOKEN"]
          USER = os.environ["GITHUB_USERNAME"]

          headers = {
              "Authorization": f"token {TOKEN}",
              "Accept": "application/vnd.github+json"
          }

          SEARCH_URL = "https://api.github.com/search/issues"

          def search(query):
              r = requests.get(
                  SEARCH_URL,
                  headers=headers,
                  params={"q": query, "per_page": 100}
              )
              r.raise_for_status()
              return r.json()["items"]

          def repo_name(item):
              return "/".join(item["repository_url"].split("/")[-2:])

          print("\n==============================")
          print(" ðŸ”“ OPEN PULL REQUESTS")
          print("==============================")
          open_prs = search(f"author:{USER} type:pr is:open")
          for pr in open_prs:
              print(f"- {repo_name(pr)} | {pr['title']}")
              print(f"  {pr['html_url']}")
          print(f"TOTAL OPEN PRs: {len(open_prs)}\n")

          print("==============================")
          print(" âœ… MERGED PULL REQUESTS")
          print("==============================")
          merged_prs = search(f"author:{USER} type:pr is:merged")
          for pr in merged_prs:
              print(f"- {repo_name(pr)} | {pr['title']}")
              print(f"  {pr['html_url']}")
          print(f"TOTAL MERGED PRs: {len(merged_prs)}\n")

          print("==============================")
          print(" ðŸ“ ISSUES CREATED BY ME")
          print("==============================")
          issues = search(f"author:{USER} type:issue")
          for issue in issues:
              print(f"- {repo_name(issue)} | {issue['title']}")
              print(f"  {issue['html_url']}")
          print(f"TOTAL ISSUES CREATED: {len(issues)}\n")

          print("==============================")
          print(" ðŸ‘€ PRs I REVIEWED")
          print("==============================")
          reviewed_prs = search(f"reviewed-by:{USER} type:pr")
          for pr in reviewed_prs:
              print(f"- {repo_name(pr)} | {pr['title']}")
              print(f"  {pr['html_url']}")
          print(f"TOTAL PRs REVIEWED: {len(reviewed_prs)}\n")

          print("==============================")
          print(" ðŸ“Š SUMMARY")
          print("==============================")
          print(f"Open PRs     : {len(open_prs)}")
          print(f"Merged PRs   : {len(merged_prs)}")
          print(f"Issues Filed : {len(issues)}")
          print(f"PRs Reviewed : {len(reviewed_prs)}")
          print("==============================\n")
          EOF
